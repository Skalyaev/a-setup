#!/bin/bash
RED='\033[0;31m'
YELLOW='\033[0;33m'
GREEN='\033[0;32m'
BLUE='\033[0;34m'
GRAY='\033[0;37m'
NC='\033[0m'

USAGE="$GRAY===================usage$NC
$YELLOW$(basename "$0") $BLUE<archive(s)>$NC

extracts the given archive(s)
"
(( "$#" < 1 )) && echo -e "$USAGE" && exit 1

is_installed() {
    local app="$1"
    grep -q 'install ok installed'\
        <<<"$(dpkg-query -W -f='${Status}' "$app" 2>'/dev/null')"\
        && return 0

    echo -e "$app needed, install ?"
    select x in 'Yes' 'No'; do
        case "$x" in
        'Yes')
            echo -e "${BLUE}Installing$NC $app..."
            ! apt install -y "$app" &> '/dev/null'\
                && echo -e "[$RED KO $NC] apt failed"\
                && return 1
            echo -e "[$GREEN OK $NC]"
            return 0
            ;;
        'No') return 1;;
        esac
    done
}
do_extract() {
    local app="$1"
    local cmd="$2"
    ! is_installed "$app"\
        && echo -e "[$YELLOW WARN $NC] can not extract $file"\
        && return 1

    echo -ne "${BLUE}Extracting$NC $file..."
    eval "$cmd" &> '/dev/null'
    echo -e "[$GREEN OK $NC]"
    return 0
}
while (( "$#" > 0 )); do
    file="$1"
    echo "file: $file"
    shift
    [[ ! -e "$file" ]]\
        && echo -e "[$YELLOW WARN $NC] $file not found"\
        && continue
    case "$file" in
        *'.zip') do_extract 'unzip' "unzip -q $file";;
        *'.rar') do_extract 'unrar' "unrar x -o- $file";;
        *'.tar') do_extract 'tar' "tar xf $file";;
        *'.tar.gz') do_extract 'tar' "tar xzf $file";;
        *'.tgz') do_extract 'tar' "tar xzf $file";;
        *) echo -e "[$YELLOW WARN $NC] Can not extract $file";;
    esac
done
