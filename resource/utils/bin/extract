#!/bin/bash
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
BLUE='\033[0;34m'
GRAY='\033[0;37m'
NC='\033[0m'

USAGE="$GRAY===================USAGE
$YELLOW$(basename "$0") $BLUE<archive(s)>$NC

extracts the given archive(s)
"
if (( ! "$#" ));then
    echo -e "$USAGE"
    exit 1
fi

is_installed() {
    local app="$1"
    grep -q 'install ok installed'\
        <<<"$(dpkg-query -W -f='${Status}' "$app" 2>'/dev/null')"\
        && return 0

    echo -e "$app needed, install ?"
    select x in 'Yes' 'No';do
        case "$x" in
        'Yes')
            echo -e "${BLUE}Installing$NC $app..."
            if ! sudo apt install -y "$app" &> '/dev/null';then
                echo -e "[$RED KO $NC] apt failed"
                return 1
            fi
            echo -e "[$GREEN OK $NC]"
            return 0
            ;;
        'No') return 1;;
        esac
    done
}
do_extract() {
    local app="$1"
    local cmd="$2"
    if ! is_installed "$app";then
        echo -e "[$YELLOW WARN $NC] can not extract $file"
        return 1
    fi
    echo -e "${BLUE}Extracting$NC $file..."
    eval "$cmd"
    echo -e "[$GREEN EXTRACTED $NC] $file"
    return 0
}
while (( "$#" ));do
    file="$1"
    echo "file: $file"
    shift
    if [[ ! -f "$file" ]];then
        echo -e "[$YELLOW WARN $NC] $file not found"
        continue
    fi
    case "$file" in
        *'.zip') do_extract 'unzip' "unzip -q $file";;
        *'.rar') do_extract 'unrar' "unrar x -o- $file";;
        *'.iso') do_extract 'p7zip-full' "7z x $file";;
        *'.tar') do_extract 'tar' "tar xf $file";;
        *'.tar.gz') do_extract 'tar' "tar xzf $file";;
        *'.tar.xz') do_extract 'tar' "tar xJf $file";;
        *'.tar.bz2') do_extract 'tar' "tar xjf $file";;
        *'.gz') do_extract 'gzip' "gunzip $file";;
        *'.tgz') do_extract 'tar' "tar xzf $file";;
        *) echo -e "[$YELLOW WARN $NC] Can not extract $file";;
    esac
done
